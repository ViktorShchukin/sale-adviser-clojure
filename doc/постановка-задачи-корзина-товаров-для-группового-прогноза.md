# План реализации функции "корзина товаров" для группового предсказания

## Назначение/цель



## Общие предложения

### Бэк

- корзина реализуется как отдельная таблица в бд
- управление корзиной происходить через REST API сервера
-  

### Фронт

- корзина товаров выглядить как отдельная форма приложения, 
которая отображает состояние корзины в бд для ползователя
- товары в корзину добавляются из формы поиска товаров(__SearchProduct__)
нажатием кнопки на товаре
- Удаление товара из корзины реализуется на форме корзины
через кнопку на товаре 
- На форме корзины есть кнопка для полной отчистки корзины
- На форме корзины есть кнопка для группового прогноза всех товаров 
в корзине 
- Должна быть реализована возможность редактирования полученных прогнозов
для отдельных товаров
- Должна быть реализована возможность экспорта группового прогноза в виде
файла. todo обсудить формат экспортируемого файла

## Реализация 

### БД

Первый шаг для реализации корзины - это организовать миграцию базы данных.
Корзину реализовать как кортеж в отдельной таблице. После чего 
организовать связь корзин как многое-ко-многому с таблицей продуктов. 
Структура таблиц:
```agsl
CREATE TABLE IF NOT EXIST product_groups (
    id UUID NOT NULL,
    creation_date DATE NOT NULL,
    name VARCHAR NOT NULL, 

    CONSTRAINT product_groups_pk PRIMARY KEY (id),
    CONSTRAINT product_groups_unique UNIQUE (name)
); 

CREATE TABLE IF NOT EXIST product_and_groups (
    product_id UUID NOT NULL,
    group_id UUID NOT NULL,

    CONSTRAINT product_and_groups_product_id_fk FOREING KEY (product_id) REFERENCES product (id),
    CONSTRAINT product_and_groups_group_id_fk FOREING KEY (group_id) REFERENCES product_groups (id),
    CONSTRAINT product_and_groups_pk PRIMARY KEY (product_id, group_id)
)
```

### Бэк 

Реализовать следующие точки REST API: 

| hhtp method        | path                                            | verb                                                  |  
|:-------------------|:------------------------------------------------|:------------------------------------------------------|
| for groups         |
| GET                | /dictionary/group/                              | get-all-groups-of-product                             |  
| GET                | /dictionary/group/:group-id                     | get-group-of-product-by-id                            |  
| POST               | /dictionary/group/                              | create-new-group-of-product                           |  
| PUT                | /dictionary/group/:group-id                     | update-group-of-product                               |  
| DELETE             | /dictionary/group/:group-id                     | delete-group-of-product-by-id                         |  
| for product in group| 
| GET                | /dictionary/group/:group-id/product             | get-all-product-of-group-by-group-id                  |  
| GET                | /dictionary/group/:group-id/product/:product-id | get-product-by-group-id-product-id                    |  
| POST               | /dictionary/group/:group-id/product/:product-id | insert-product-in-group                               |  
| PUT                |                                                 | update-product-in-group -- need to be not implemented |  
| DELETE             | /dictionary/group/:group-id/product/:product-id | delete-product-in-group                               |  

### Фронт 

Когда оператор открывает страницу с формой корзины, приложение делает
запрос на бэк(GET /dictionary/group/) и отображает список доступных корзин.
Результат отображается как строки с названиями групп. В каждой строке по группе
(1-first-enterece-group)

Когда оператор выбирает одну из корзин, приложение 
делает запрос на бэк (GET /dictionary/group/:group-id/product)
и отображает все товары в выбранной в корзине.
Результаты отображаются как список строк с наименованиями товаров.
В каждой строке по одному товару. (2-after-pick-group)

Когда оператор нажимает на кнопку add-product 
открывается форма по поиску продукта. Оператор может выделить 
нужные ему продукты. Нажав кнопку add выделенные 
продукты добавляются в корзину. После нажатия кнопки add
форма поиска закрывается.

Когда оператор нажимает на кнопку do-prediction 
приложение отправляет запрос на бэк (GET /dictionary/product/:productId/prediction/:date)
и отображает результаты справа от товаров.
Результат прогноза выглядит как две формы. В левой, значение пришедшее с бэка, в правой пустая форма 
<input> в которую оператор может записать свое собственное значение. 
(3-after-clic-do-prediction)

При нажатии оператором кнопки export-result приложение формирует документ. 
В поле со значением предсказания первоочередно вписывается значение 
введенное оператором. Если <input> для ручного ввода прогноза
был пустой, то берется значение пришедшее с бэка.


Поле prediction-date реализовать как <input>. 
todo можно ли чтоб в инпуте постоянно отображалось состояние date из elm model


### Сценарии использования 

#### 1. Управление группой товаров
- Оператор открывает форму корзины
- Выбирает нужную группу кликнув на нее
- - Если список доступных корзин пуст или оператор хочет создать новую, он нажимает кнопку "создать новую группу"
- Для добавления товара оператор нажимает кнопку add-product 
- - Оператор находит нужную позицию 
- - Оператор нажимает кнопку add
- Для удаления товара оператор нажимает кнопку delete-product напротив нужной позиции в списке группы
- Для уладения всей группы оператор нажимает кнопку delete-group
- После выполнения всех запланнированных действий оператор закрывает форму


#### 

#### 2. Создание групповога прогноза и его экспорт в виде файла
- Оператор открывает форму корзины
- Выберает нужную ему группу  
- В полк prediction-date выставляет дату на которую делается прогноз
- Оператор нажимает кнопку do-prediction
- Если результат прогноза по позиции не устраивает, оператор вводит свое значение в специальную форму в строке с позицией 
- После получения удовлетворительных результатов прогноза оператор нажимает кнопку export-prediction 
- После выполнения всех вышеперечисленных действий закрывает форму корзины 


## Выводы 

